# Bug B04: Unconditional sync_main() in wt_new()

## Severity
**High Priority**

## Location
`src/worktreeflow/wtf.py:942`

## Description
The `wt_new()` function unconditionally calls `sync_main()` before creating a worktree, which can fail unexpectedly or modify the user's main branch without clear warning.

## Current Code
```python
def wt_new(self, slug: str, base: str = "main") -> None:
    """Create worktree and new feature branch from fork/main."""
    # Validate and clean slug
    slug = self.validator.validate_slug(slug)
    branch_name = f"feat/{slug}"

    # Validate branch name
    self.validator.validate_branch_name(branch_name)

    console.print(f"[cyan]Creating worktree for {branch_name}...[/cyan]")

    # Sync main first
    self.sync_main(base=base)  # <-- No error handling, could fail

    # Get worktree path
    worktree_path = self._get_worktree_path(slug)
    # ...
```

## Problem
1. **Unexpected side effects**: Users calling `wt-new` don't expect their main branch to be modified
2. **No error handling**: If sync fails (network issues, diverged branches), the entire operation fails with unclear error
3. **Workflow assumption**: Assumes users always want to sync before creating worktree, which may not be true
4. **Poor error messages**: Users get sync_main errors when they just wanted to create a worktree

## Impact
- Users on slow/offline networks can't create worktrees
- Main branch divergence blocks all worktree creation
- Confusing error messages when `wt-new` fails during sync phase
- Unexpected modifications to main branch

## Example Failure Scenario
```bash
$ wtf wt-new my-feature
[cyan]Creating worktree for feat/my-feature...[/cyan]
[cyan]Syncing main with upstream...[/cyan]
Fetching upstream...
[red]ERROR: Cannot fast-forward main to upstream/main
Your main has diverged from upstream.
...
```

User thinks: "I just wanted to create a worktree, why is it syncing main?"

## Proposed Fix

### Option 1: Make sync optional with flag
```python
def wt_new(self, slug: str, base: str = "main", sync: bool = True) -> None:
    """Create worktree and new feature branch from fork/main."""
    slug = self.validator.validate_slug(slug)
    branch_name = f"feat/{slug}"
    self.validator.validate_branch_name(branch_name)

    console.print(f"[cyan]Creating worktree for {branch_name}...[/cyan]")

    # Optionally sync main first
    if sync:
        console.print(f"[dim]Syncing {base} with upstream first...[/dim]")
        try:
            self.sync_main(base=base)
        except Exception as e:
            console.print(f"[yellow]Warning: Could not sync {base}: {e}[/yellow]")
            console.print(f"Continuing with worktree creation from current {base}...")
            console.print(f"Run 'wtf sync-main' separately if needed.")

    # Rest of worktree creation...
```

### Option 2: Add graceful error handling
```python
def wt_new(self, slug: str, base: str = "main") -> None:
    # ...

    console.print(f"[cyan]Creating worktree for {branch_name}...[/cyan]")

    # Try to sync main, but don't fail if it doesn't work
    try:
        console.print(f"[dim]Syncing {base} with upstream...[/dim]")
        self.sync_main(base=base)
    except GitCommandError as e:
        console.print(f"[yellow]Warning: Could not sync {base}[/yellow]")
        console.print(f"[yellow]{e.stderr}[/yellow]")

        response = input(f"\nContinue creating worktree from current {base}? [y/N]: ")
        if response.lower() != 'y':
            console.print("[red]Aborted[/red]")
            sys.exit(1)

    # Rest of worktree creation...
```

## CLI Change
Add option to CLI command:
```python
@cli.command('wt-new')
@click.argument('slug')
@click.option('--base', default='main', help='Base branch to branch from')
@click.option('--no-sync', is_flag=True, help='Skip syncing base branch')
@click.pass_obj
def wt_new(manager, slug, base, no_sync):
    """Create worktree + new feature branch from fork/main."""
    manager.wt_new(slug, base, sync=not no_sync)
```

## Recommendation
Option 1 (make sync optional) provides the best user experience while maintaining safe defaults.
